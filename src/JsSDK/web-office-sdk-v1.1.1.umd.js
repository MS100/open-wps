!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).WebOfficeSDK={})}(this,function(e){"use strict";var t=function(){return(t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function n(e,t,n,r){return new(n||(n=Promise))(function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(i,c)}s((r=r.apply(e,t||[])).next())})}function r(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}var a=function(){function e(){}return e.add=function(t){e._handleList.push(t),window.addEventListener("message",t,!1)},e.remove=function(t){var n=e._handleList.indexOf(t);n>=0&&e._handleList.splice(n,1),window.removeEventListener("message",t,!1)},e.empty=function(){for(;e._handleList.length;)window.removeEventListener("message",e._handleList.shift(),!1)},e.parse=function(e){return"object"==typeof e?e:JSON.parse(e)},e._handleList=[],e}();var o,i,c,s=this;!function(e){e.unknown="unknown",e.spreadsheet="s",e.writer="w",e.presentation="p",e.pdf="f"}(o||(o={})),function(e){e.wps="w",e.et="s",e.presentation="p",e.pdf="f"}(i||(i={})),function(e){e.nomal="nomal",e.simple="simple"}(c||(c={}));var u,p,l=(u=0,function(){return++u}),f=function(e,t){if(!p){(p=document.createElement("iframe")).classList.add("web-office-iframe");var n={id:"office-iframe",src:e,scrolling:"no",frameborder:"0",allowfullscreen:"allowfullscreen",webkitallowfullscreen:"true",mozallowfullscreen:"true",style:"width: 100%; height: 100%;"};for(var r in t||((t=document.createElement("div")).classList.add("web-office-default-container"),function(e){var t=document.createElement("style");document.head.appendChild(t);var n=t.sheet;n.insertRule(e,n.cssRules.length)}(".web-office-default-container {position: absolute; padding: 0;  margin: 0; width: 100vw; height: 100vh; left: 0; top: 0;}"),document.body.appendChild(t)),n)p.setAttribute(r,n[r]);t.appendChild(p),p.destroy=function(){p.parentNode.removeChild(p),p=null}}return p},d=function(e){f().contentWindow.postMessage(JSON.stringify(e),"*")},v=function(e){return new Promise(function(t){var n=l(),r=function(e){var o=a.parse(e.data);"wps.api.reply"===o.eventName&&o.msgId===n&&(t(o.data),a.remove(r))};a.add(r),d({eventName:"wps.jssdk.api",data:e,msgId:n})})},b=[],h=!1,m=!1,w=function(){b=[],h=[],m=!1},y=function(e,o,i,c){return n(s,void 0,void 0,function(){var s,u,p,f,v,w,y,j,k,I;return r(this,function(O){return s=h||b,u=l(),v=new Promise(function(e,t){p=e,f=t}),w={},o.args&&(y=function(e){var t={};return[e=e.map(function(e){if(function(e){if(!e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(e)){var n={};for(var r in e){var a=e[r];if("function"==typeof a){var o=l();t[o]=a,a={callbackId:o}}n[r]=a}return n}return"function"==typeof e?(o=l(),t[o]=e,{callbackId:o}):e}),t]}(o.args),j=y[0],k=y[1],o.args=j,w=k),I=function(){var t=this,o=function(c){return n(t,void 0,void 0,function(){var t,n,s;return r(this,function(r){switch(r.label){case 0:return"api.callback"===(t=a.parse(c.data)).eventName&&t.callbackId&&w[t.callbackId]?[4,g(function(e){return w[e.callbackId].apply(w,e.data.args)},t)]:[3,2];case 1:n=r.sent(),d({eventName:"api.callback.reply",result:n,callbackId:t.callbackId}),r.label=2;case 2:return t.eventName===e+".reply"&&t.msgId===u&&(t.error?((s=new Error("")).stack=t.error+"\n"+i,f(s)):p(t.result),a.remove(o)),[2]}})})};return a.add(o),v},s.push([{eventName:e,data:o,msgId:u},I,c]),function(e){n(this,void 0,void 0,function(){var a=this;return r(this,function(o){switch(o.label){case 0:return m||!e.length?[3,2]:[4,m=n(a,void 0,void 0,function(){var n,a,o,i,c,s,u;return r(this,function(r){switch(r.label){case 0:if(!e.length)return[3,5];if(n=e.shift(),!Array.isArray(n))return e.push.apply(e,n.child),[3,5];a=n[0],o=n[1],i=n[2],"function"==typeof(a=t({},a)).data&&(a.data=a.data()),d(a),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,o()];case 2:return r.sent(),[3,4];case 3:if(c=r.sent(),i&&i.__catch)i.__catch(c);else for(;e.length;)s=e.shift(),(u=s[2])&&u.rollback&&u.rollback();return[3,4];case 4:return[3,0];case 5:return[2]}})})];case 1:o.sent(),m=!1,o.label=2;case 2:return[2]}})})}(s),[2,v.catch(function(){})]})})};function g(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];return n(this,void 0,void 0,function(){var n;return r(this,function(r){switch(r.label){case 0:return h=[],b.push({child:h}),[4,e.apply(void 0,t)];case 1:return n=r.sent(),h=!1,[2,n]}})})}var j=function(e,n){void 0===n&&(n=!0);var r=t({},e),a=r.headers,o=void 0===a?{}:a,i=r.subscriptions,s=void 0===i?{}:i,u=r.mode,p=void 0===u?c.nomal:u,l=o.backBtn,f=void 0===l?{}:l,d=o.shareBtn,v=void 0===d?{}:d,b=o.otherMenuBtn,h=void 0===b?{}:b,m=function(e,t){e.subscribe&&"function"==typeof e.subscribe&&(e.callback=t,s[t]=e.subscribe,n&&delete e.subscribe)};if(m(f,"wpsconfig_back_btn"),m(v,"wpsconfig_share_btn"),m(h,"wpsconfig_other_menu_btn"),h.items&&Array.isArray(h.items)){var w=[];h.items.forEach(function(e,t){switch(void 0===e&&(e={}),e.type){case"export_img":e.type=1,e.callback="export_img";break;case"export_pdf":e.type=1,e.callback="export_pdf";break;case"save_version":e.type=1,e.callback="save_version";break;case"about_wps":e.type=1,e.callback="about_wps";break;case"split_line":e.type=2;break;case"custom":e.type=3,m(e,"wpsconfig_other_menu_btn_"+t),w.push(e)}}),w.length&&(x||E)&&(h.items=w)}if(r.url=r.url||r.wpsUrl,(p===c.simple||r.commonOptions&&!1===r.commonOptions.isShowTopArea)&&r.url&&(r.url+="&simple&hidecmb"),r.debug&&r.url&&(r.url+="&debugger"),r.wordOptions&&(r.wpsOptions=r.wordOptions),r.excelOptions&&(r.etOptions=r.excelOptions),r.pptOptions&&(r.wppOptions=r.pptOptions),"object"==typeof s.print){var y="wpsconfig_print";"function"==typeof s.print.subscribe&&(s[y]=s.print.subscribe,r.print={callback:y},void 0!==s.print.custom&&(r.print.custom=s.print.custom)),delete s.print}"function"==typeof s.exportPdf&&(s[y="wpsconfig_export_pdf"]=s.exportPdf,r.exportPdf={callback:y},delete s.exportPdf);return t({},r,{subscriptions:s})},k=function(e){void 0===e&&(e="");var t="";if(!t&&e){var n=e.toLowerCase();-1!==n.indexOf("/office/s/")&&(t=o.spreadsheet),-1!==n.indexOf("/office/w/")&&(t=o.writer),-1!==n.indexOf("/office/p/")&&(t=o.presentation),-1!==n.indexOf("/office/f/")&&(t=o.pdf)}if(!t){var r=e.match(/[\?&]type=([a-z]+)/)||[];t=i[r[1]]||""}return t};function I(e,t){void 0===t&&(t=!0);var n=e.map(function(e){var t=e.attributes;if(!Array.isArray(t)){var n=[];for(var r in t)if(t.hasOwnProperty(r)){var a={name:r,value:t[r]};n.push(a)}e.attributes=n}return e});return t&&d({eventName:"setCommandBars",data:n}),n}var O,_=window.navigator.userAgent.toLowerCase(),x=/Android|webOS|iPhone|iPod|BlackBerry|iPad/i.test(_),E=function(){try{return-1!==window._parent.location.search.indexOf("from=wxminiprogram")}catch(e){return!1}}();function P(e){return e=e||Object.create(null),{on:function(t,n){(e[t]||(e[t]=[])).push(n)},off:function(t,n){e[t]&&e[t].splice(e[t].indexOf(n)>>>0,1)},emit:function(t,n){(e[t]||[]).slice().map(function(e){e(n)}),(e["*"]||[]).slice().map(function(e){e(t,n)})}}}!function(e){e[e.msoFalse=0]="msoFalse",e[e.msoTrue=-1]="msoTrue"}(O||(O={}));var C=0,A=new Set;function N(e){return++C,!e&&function(e){A.forEach(function(t){return t(e)})}(C),C}function B(e,i){var c,s=this,u=i.Events,p=i.Enum,l=i.Props,f=l[0],v=l[1],b={objId:C};switch(function e(n,r,a){r=r.slice(0);var o=function(){var o=r.shift();!o.alias&&~L.indexOf(o.prop)&&r.push(t({},o,{alias:o.prop+"Async"})),Object.defineProperty(n,o.alias||o.prop,{get:function(){var r=this,i=1===o.cache,c=i&&this["__"+o.prop+"CacheValue"];if(c)return c;var s=new Error(""),u=s.stack.split("\n").slice(2).join("\n"),p=N(i),l=function(){for(var e,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];void 0!==o.caller?function e(n,r,a){r=r.slice(0);var o=function(){var o=r.shift();!o.alias&&~L.indexOf(o.prop)&&r.push(t({},o,{alias:o.prop+"Async"})),Object.defineProperty(n,o.alias||o.prop,{get:function(){var t=this,r=1===o.cache,i=r&&this["__"+o.prop+"CacheValue"];if(i)return i;var c=new Error(""),s=c.stack.split("\n").slice(2).join("\n"),u=N(r),p=function(){for(var t,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];void 0!==o.caller?e(t={objId:N()},a[o.caller],a):t={};return T(t,"api.caller",{obj:p,parentObjId:n.objId,args:r,prop:o.prop},s),t};return p.objId=-1,void 0!==o.getter&&(p.objId=u,e(p,a[o.getter],a)),T(p,"api.getter",{parentObjId:n.objId,objId:p.objId,prop:o.prop},s,function(){delete t["__"+o.prop+"CacheValue"]}),r&&(this["__"+o.prop+"CacheValue"]=p),p},set:function(e){var t=new Error(""),r=t.stack.split("\n").slice(2).join("\n");return T({},"api.setter",{parentObjId:n.objId,objId:-1,prop:o.prop,value:e},r)}})};for(;r.length;)o()}(e={objId:N()},a[o.caller],a):e={};return T(e,"api.caller",{obj:l,parentObjId:n.objId,args:r,prop:o.prop},u),e};return l.objId=-1,void 0!==o.getter&&(l.objId=p,e(l,a[o.getter],a)),T(l,"api.getter",{parentObjId:n.objId,objId:l.objId,prop:o.prop},u,function(){delete r["__"+o.prop+"CacheValue"]}),i&&(this["__"+o.prop+"CacheValue"]=l),l},set:function(e){var t=new Error(""),r=t.stack.split("\n").slice(2).join("\n");return T({},"api.setter",{parentObjId:n.objId,objId:-1,prop:o.prop,value:e},r)}})};for(;r.length;)o()}(b,f,v),b.Events=u,b.Enum=p,e.Enum=b.Enum,e.Events=b.Events,k(e.url)){case o.writer:e.WordApplication=e.WpsApplication=function(){return b};break;case o.spreadsheet:e.ExcelApplication=e.EtApplication=function(){return b};break;case o.presentation:e.PPTApplication=e.WppApplication=function(){return b};break;case o.pdf:e.PDFApplication=function(){return b}}e.Application=b,e.Free=function(e){return y("api.free",{objId:e},"")},e.Stack=b.Stack=(c=function(t){return e.Free(t)},function(){var e=[],t=function(t){e.push(t)};return A.add(t),{End:function(){c(e),A.delete(t)}}});var h={};a.add(function(e){return n(s,void 0,void 0,function(){var t,n,o,i,c;return r(this,function(r){switch(r.label){case 0:return"api.event"===(t=a.parse(e.data)).eventName&&t.data?(n=t.data,o=n.eventName,i=n.data,n.objIds,(c=h[o])?[4,g(function(){return c(i)})]:[3,2]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})}),b.Sub={},Object.values(u).forEach(function(e){Object.defineProperty(b.Sub,e,{set:function(t){h[e]=t,d({eventName:"api.event.register",data:{eventName:e,register:!!t,objId:++C}})}})})}var S,L=["ExportAsFixedFormat","GetOperatorsInfo","ImportDataIntoFields","ReplaceText","ReplaceBookmark","GetBookmarkText","GetComments"];function D(e,n,r){n=n.slice(0);var a=function(){var a=n.shift();if(!a.alias&&~L.indexOf(a.prop)){n.push(t({},a,{alias:a.prop+"Async"}))}Object.defineProperty(e,a.alias||a.prop,{get:function(){var t=this;var n=a.cache===1;var o=n&&this["__"+a.prop+"CacheValue"];if(!o){var i=new Error("");var c=i.stack.split("\n").slice(2).join("\n");var s=N(n);var u=function(){for(var t=[],n=0,o;n<arguments.length;n++){t[n]=arguments[n]}if(a.caller!==undefined){o={objId:N()};D(o,r[a.caller],r)}else{o={}}return T(o,"api.caller",{obj:p,parentObjId:e.objId,args:t,prop:a.prop},c),o};var p=u;p.objId=-1;if(a.getter!==undefined){p.objId=s;D(p,r[a.getter],r)}T(p,"api.getter",{parentObjId:e.objId,objId:p.objId,prop:a.prop},c,function(){delete t["__"+a.prop+"CacheValue"]});if(n){this["__"+a.prop+"CacheValue"]=p}return p}else{return o}},set:function(t){var n=new Error("");var r=n.stack.split("\n").slice(2).join("\n");return T({},"api.setter",{parentObjId:e.objId,objId:-1,prop:a.prop,value:t},r)}})};while(n.length){a()}}function T(e,t,n,r,a){var o={rollback:a},i=y(t,n,r,o);e.then=function(e,t){return i.then(e,t)},e.catch=function(e){return o.__catch=e,i.catch(e)},e.Destroy=function(){return y("api.free",{objId:e.objId},"")}}var V="fileOpen",F=function(e){return"api.ready"===e},R=function(e,t){void 0===e&&(e={});a.add(function(n){var r=a.parse(n.data),o=r.eventName,i=void 0===o?"":o,c=r.data,s=void 0===c?null:c,u=r.url,p=void 0===u?null:u;-1===["wps.jssdk.api"].indexOf(i)&&("ready"===i?(d({eventName:"setConfig",data:e}),S.tokenData&&d({eventName:"setToken",data:S.tokenData}),S.commandBars&&I(S.commandBars),S.iframeReady=!0):"open.result"===i?S.emit(V,s):"api.ready"===i&&B(S,s),"function"==typeof t[i]&&t[i](S,p||s))})};function W(e){void 0===e&&(e={}),S&&S.destroy();try{var n,r=j(e),o=r.subscriptions,i=void 0===o?{}:o,c=r.mount,s=void 0===c?null:c,u=r.url,p=f(u,s);return delete r.mount,u&&delete r.url,delete r.subscriptions,S={url:u,version:"1.1.1",iframe:p,Enum:t({},O),iframeReady:!1,tokenData:null,commandBars:null,setToken:function(e){S.tokenData=e,S.iframeReady&&d({eventName:"setToken",data:e})},ready:function(){return n||(n=new Promise(function(e){var t=function(n){var r=a.parse(n.data).eventName;F(r)&&(e(),a.remove(t))};a.add(t)}))},destroy:function(){p.destroy(),a.empty(),S=null,w(),A=new Set,C=0},save:function(){return v({api:"save"})},setCommandBars:function(e){S.commandBars=I(e,S.iframeReady)},updateConfig:function(e){if(void 0===e&&(e={}),e.commandBars)return console.warn("Deprecated: `updateConfig()` 方法即将废弃，请使用`setCommandBars()`代替`updateConfig()`更新`commandBars`配置。"),I(e.commandBars)}},S=t({},S,new P.prototype.constructor),R(r,i),S.ready(),S}catch(e){console.error(e)}}console.log("WebOfficeSDK JS-SDK V1.1.1");var G=Object.freeze({Listener:R,config:W});window.WPS=G;var z=W,J={config:z};e.config=z,e.default=J,Object.defineProperty(e,"__esModule",{value:!0})});
